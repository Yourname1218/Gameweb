<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰øÑÁæÖÊñØÊñπÂ°ä</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            font-family: 'SuperMario', 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        @font-face {
            font-family: 'Press Start 2P';
            src: url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        }

        @font-face {
            font-family: 'SuperMario';
            src: url('https://fonts.cdnfonts.com/css/new-super-mario-font-u');
        }

        .game-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
        }

        #gameCanvas {
            width: 800px;
            height: 600px;
            background: #000033;
            border: none;
            position: relative;
            box-shadow: 
                -4px -4px 0 0 #e75a10,
                4px -4px 0 0 #e75a10,
                -4px 4px 0 0 #e75a10,
                4px 4px 0 0 #e75a10,
                inset -4px -4px 0 0 #feb142,
                inset 4px -4px 0 0 #feb142,
                inset -4px 4px 0 0 #873000,
                inset 4px 4px 0 0 #873000,
                0 0 0 4px #e75a10;
        }

        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            color: #fff;
            text-shadow: 4px 4px #ff0000;
            opacity: 0;
            pointer-events: none;
            animation: countdownAnim 1s ease-in-out;
            font-family: 'SuperMario', 'Press Start 2P', cursive;
        }

        @keyframes countdownAnim {
            0% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
        }

        /* Ê∑ªÂä†ËÉåÊôØÂãïÁï´ */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background-image: 
                linear-gradient(0deg, #87CEEB 0%, #87CEEB 40%, #0099ff 40%, #0099ff 60%, #87CEEB 60%, #87CEEB 100%),
                repeating-linear-gradient(0deg, transparent 0%, transparent 40%, #00ff00 40%, #00ff00 45%, transparent 45%, transparent 100%);
            background-size: 100% 100%, 100px 100%;
            animation: scrollBackground 20s linear infinite;
            z-index: -2;
        }

        .pixel-cloud {
            position: fixed;
            z-index: -1;
            opacity: 0.9;
            animation: floatCloud linear;  /* ÂãïÁï´ÊôÇÈñìÊúÉÂú® JavaScript ‰∏≠Ë®≠ÂÆö */
        }

        .cloud-small {
            width: 80px;
            height: 40px;
        }

        .cloud-medium {
            width: 120px;
            height: 60px;
        }

        .cloud-large {
            width: 160px;
            height: 80px;
        }

        .cloud-svg {
            width: 100%;
            height: 100%;
            fill: white;
            filter: url(#pixelate);
        }

        .pixel-mountain {
            position: absolute;
            bottom: -150px;
            width: 100%;
            height: 150px;
            background: repeating-linear-gradient(
                45deg,
                #4a9c2e 0%,
                #4a9c2e 10%,
                #3d8325 10%,
                #3d8325 20%
            );
            clip-path: polygon(0% 100%, 20% 40%, 40% 80%, 60% 20%, 80% 60%, 100% 10%, 100% 100%);
            z-index: -1;
            animation: mountainRise 1s ease-out 0.5s forwards;
        }

        .bird {
            position: absolute;
            width: 50px;
            height: 30px;
            z-index: -1;
            opacity: 0;
            transform-origin: center;
        }

        .bird-svg {
            width: 100%;
            height: 100%;
            fill: #333;
        }

        .bird .wing {
            transform-origin: 20px 15px;
            animation: flapWing 0.4s infinite alternate ease-in-out;
        }

        .pixel-star {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: twinkle 1s infinite alternate;
        }

        @keyframes scrollBackground {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }

        @keyframes mountainRise {
            0% { bottom: -150px; transform: scale(0.95); }
            60% { bottom: -20px; transform: scale(1.02); }
            80% { bottom: -10px; transform: scale(0.98); }
            100% { bottom: 0; transform: scale(1); }
        }

        @keyframes flapWing {
            0% { transform: rotate(-30deg) scale(1.1); }
            100% { transform: rotate(30deg) scale(0.9); }
        }

        @keyframes twinkle {
            from { opacity: 0.3; }
            to { opacity: 1; }
        }

        /* ÈÅäÊà≤ÂçÄÂüüÊ®£Âºè */
        .game-area {
            display: grid;
            grid-template-columns: auto 150px;
            gap: 10px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            box-shadow: 
                -4px -4px 0 0 #e75a10,
                4px -4px 0 0 #e75a10,
                -4px 4px 0 0 #e75a10,
                4px 4px 0 0 #e75a10,
                inset -4px -4px 0 0 #feb142,
                inset 4px -4px 0 0 #feb142,
                inset -4px 4px 0 0 #873000,
                inset 4px 4px 0 0 #873000,
                0 0 0 4px #e75a10;
        }

        .main-board {
            width: 300px;
            height: 600px;
            border: 4px solid #fff;
            background: rgba(0, 0, 51, 0.8);
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .preview-box {
            width: 120px;
            height: 120px;
            border: 4px solid #fff;
            background: rgba(0, 0, 51, 0.8);
        }

        .score-box {
            padding: 10px;
            border: 4px solid #fff;
            background: rgba(0, 0, 51, 0.8);
            color: #fff;
            font-size: 20px;
            text-align: center;
            width: 120px;
            font-family: 'SuperMario', 'Press Start 2P', cursive;
        }

        .controls {
            color: #fff;
            font-size: 14px;
            text-align: left;
            padding: 10px;
            border: 4px solid #fff;
            background: rgba(0, 0, 51, 0.8);
            width: 120px;
            font-family: 'SuperMario', 'Press Start 2P', cursive;
        }

        /* ‰øÆÊîπÈõ≤ÊúµÁöÑÊ®£Âºè */
        @keyframes floatCloud {
            from { transform: translateX(-100px); }
            to { transform: translateX(calc(100vw + 100px)); }
        }

        /* Ê∑ªÂä†ÂõûÈ¶ñÈ†ÅÊåâÈàïÊ®£Âºè */
        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #fff;
            border-radius: 5px;
            color: #fff;
            font-family: 'SuperMario', 'Press Start 2P', cursive;
            font-size: 16px;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .home-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* ‰øÆÊîπÈÅäÊà≤ÁµêÊùüÊñáÂ≠óÂ≠óÈ´î */
        .game-over {
            font-family: 'SuperMario', 'Press Start 2P', cursive;
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="pixel-mountain"></div>
    
    <!-- Ê∑ªÂä†Èõ≤ÊúµÂíåÈ≥•ÁöÑÂÆπÂô® -->
    <div id="clouds-container"></div>
    <div id="birds-container"></div>
    
    <button class="home-button" onclick="window.location.href='Gameweb.html'">ÂõûÈ¶ñÈ†Å</button>
    
    <div class="game-container">
        <div class="game-area">
            <canvas id="mainBoard" class="main-board" width="300" height="600"></canvas>
            <div class="side-panel">
                <canvas id="previewBox" class="preview-box" width="120" height="120"></canvas>
                <div class="score-box">
                    <div>ÂàÜÊï∏: <span id="score">0</span></div>
                    <div>Á≠âÁ¥ö: <span id="level">1</span></div>
                    <div>Ê∂àÈô§Ë°åÊï∏: <span id="lines">0</span></div>
                </div>
                <div class="controls">
                    <p>‚Üê ‚Üí : Â∑¶Âè≥ÁßªÂãï</p>
                    <p>‚Üë : ÊóãËΩâ</p>
                    <p>‚Üì : Âä†ÈÄü‰∏ãËêΩ</p>
                    <p>Á©∫ÁôΩÈçµ : Áõ¥Êé•‰∏ãËêΩ</p>
                </div>
            </div>
        </div>
    </div>

    <svg style="display: none;">
        <symbol id="cloud-svg" viewBox="0 0 100 60">
            <path d="M 10,40 
                     C 10,30 20,20 30,20
                     C 30,10 40,0 55,0
                     C 70,0 80,10 80,20
                     C 90,20 100,30 100,40
                     C 100,50 90,60 80,60
                     L 20,60
                     C 10,60 0,50 10,40" 
                  fill="white"/>
        </symbol>
        
        <symbol id="bird-svg" viewBox="0 0 50 30">
            <path class="wing" d="M 15,15 Q 25,5 35,15" />
            <path d="M 40,15 
                     L 45,12
                     Q 47,15 45,18
                     L 40,15
                     M 10,15
                     Q 25,10 40,15
                     Q 25,20 10,15 Z" />
        </symbol>
    </svg>

    <svg class="pixelate-filter">
        <defs>
            <filter id="pixelate">
                <feFlood x="4" y="4" height="2" width="2"/>
                <feComposite width="8" height="8"/>
                <feTile result="a"/>
                <feComposite in="SourceGraphic" in2="a" operator="in"/>
                <feMorphology operator="dilate" radius="1"/>
            </filter>
        </defs>
    </svg>

    <script>
        // ÈÅäÊà≤Â∏∏Èáè
        const BLOCK_SIZE = 30;
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        const COLORS = [
            null,
            '#FF0D72',  // I - ‰∫ÆÁ¥Ö
            '#0DC2FF',  // J - ‰∫ÆËóç
            '#0DFF72',  // L - ‰∫ÆÁ∂†
            '#F538FF',  // O - ‰∫ÆÁ¥´
            '#FF8E0D',  // S - ‰∫ÆÊ©ô
            '#FFE138',  // T - ‰∫ÆÈªÉ
            '#3877FF',  // Z - Ê∑±Ëóç
            // È´ò‰∫ÆÁâàÊú¨ÔºàÈñÉÁàçÊïàÊûúÔºâ
            null,
            '#FF99B2',  // I - Êõ¥‰∫ÆÁöÑÁ¥Ö
            '#99EEFF',  // J - Êõ¥‰∫ÆÁöÑËóç
            '#99FFB2',  // L - Êõ¥‰∫ÆÁöÑÁ∂†
            '#FF99FF',  // O - Êõ¥‰∫ÆÁöÑÁ¥´
            '#FFCC99',  // S - Êõ¥‰∫ÆÁöÑÊ©ô
            '#FFFF99',  // T - Êõ¥‰∫ÆÁöÑÈªÉ
            '#99B2FF'   // Z - Êõ¥‰∫ÆÁöÑËóç
        ];

        // ÊñπÂ°äÂΩ¢ÁãÄÂÆöÁæ©
        const PIECES = [
            [],
            [[0, 0, 0, 0], [1, 1, 1, 1], [0, 0, 0, 0], [0, 0, 0, 0]], // I
            [[2, 0, 0], [2, 2, 2], [0, 0, 0]], // J
            [[0, 0, 3], [3, 3, 3], [0, 0, 0]], // L
            [[4, 4], [4, 4]], // O
            [[0, 5, 5], [5, 5, 0], [0, 0, 0]], // S
            [[0, 6, 0], [6, 6, 6], [0, 0, 0]], // T
            [[7, 7, 0], [0, 7, 7], [0, 0, 0]]  // Z
        ];

        // Ê∑ªÂä†Èü≥ÊïàÁîüÊàêÂô®
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        const sounds = {
            move: {
                play: () => playSound(150, 0.1, 'square', 0.3),  // ÁßªÂãïÈü≥Êïà
            },
            rotate: {
                play: () => playSound(200, 0.1, 'square', 0.3),  // ÊóãËΩâÈü≥Êïà
            },
            drop: {
                play: () => playSound(100, 0.15, 'square', 0.3),  // ËêΩÂú∞Èü≥Êïà
            },
            clear: {
                play: () => {
                    // Ê∂àË°åÈü≥ÊïàÔºà‰∏äÂçáÈü≥ÈöéÔºâ
                    playSound(300, 0.1, 'square', 0.3);
                    setTimeout(() => playSound(400, 0.1, 'square', 0.3), 50);
                    setTimeout(() => playSound(500, 0.1, 'square', 0.3), 100);
                }
            },
            gameOver: {
                play: () => {
                    // ÈÅäÊà≤ÁµêÊùüÈü≥ÊïàÔºà‰∏ãÈôçÈü≥ÈöéÔºâ
                    playSound(400, 0.1, 'square', 0.3);
                    setTimeout(() => playSound(300, 0.1, 'square', 0.3), 100);
                    setTimeout(() => playSound(200, 0.2, 'square', 0.3), 200);
                    setTimeout(() => playSound(100, 0.3, 'square', 0.3), 300);
                }
            },
            levelUp: {
                play: () => {
                    // ÂçáÁ¥öÈü≥ÊïàÔºàÂø´ÈÄü‰∏äÂçáÈü≥ÈöéÔºâ
                    playSound(300, 0.05, 'square', 0.3);
                    setTimeout(() => playSound(400, 0.05, 'square', 0.3), 50);
                    setTimeout(() => playSound(500, 0.05, 'square', 0.3), 100);
                    setTimeout(() => playSound(600, 0.1, 'square', 0.3), 150);
                }
            }
        };

        // Èü≥ÊïàÁîüÊàêÂáΩÊï∏
        function playSound(frequency, duration, type = 'square', volume = 0.3) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = type;
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }

        // ÈÅäÊà≤ÁãÄÊÖã
        let gameState = {
            score: 0,
            level: 1,
            lines: 0,
            board: Array(BOARD_HEIGHT).fill().map(() => Array(BOARD_WIDTH).fill(0)),
            piece: null,
            nextPiece: null,
            position: {x: 0, y: 0},
            isGameOver: false
        };

        // Âú® script ÈñãÈ†≠Ê∑ªÂä†ÊåâÈçµÁãÄÊÖãËøΩËπ§
        const keyState = {
            left: false,    // Â∑¶ÁÆ≠È†≠
            right: false,   // Âè≥ÁÆ≠È†≠
            down: false,    // ‰∏ãÁÆ≠È†≠
            up: false       // ‰∏äÁÆ≠È†≠
        };

        // ‰øÆÊîπÊåâÈçµÂª∂ÈÅ≤Ë®≠ÂÆö
        const KEY_REPEAT_DELAY = 150;    // Á¨¨‰∏ÄÊ¨°Êåâ‰∏ãÂà∞ÈáçË§áÁöÑÂª∂ÈÅ≤ÔºàÊØ´ÁßíÔºâ
        const KEY_REPEAT_INTERVAL = 50;  // ÈáçË§áÁßªÂãïÁöÑÈñìÈöîÔºàÊØ´ÁßíÔºâ
        let keyRepeatTimers = {
            left: null,
            right: null,
            down: null
        };

        // ‰øÆÊîπÂÄíÊï∏Ë®àÊôÇÂáΩÊï∏ÔºåÂú®ÈÅäÊà≤ÈñãÂßãÊôÇËá™ÂãïÊí≠ÊîæÈü≥Ê®Ç
        function startCountdown(callback) {
            let count = 3;
            
            function showNumber() {
                const countElement = document.createElement('div');
                countElement.className = 'countdown';
                countElement.textContent = count;
                document.body.appendChild(countElement);

                countElement.addEventListener('animationend', () => {
                    countElement.remove();
                    count--;
                    
                    if (count > 0) {
                        setTimeout(showNumber, 200);
                    } else {
                        setTimeout(() => {
                            // ÂàùÂßãÂåñ‰∏¶ÈñãÂßãÊí≠ÊîæËÉåÊôØÈü≥Ê®Ç
                            if (!bgMusic.context) {
                                bgMusic.init();
                            }
                            bgMusic.start();
                            
                            // ÈñãÂßãÈÅäÊà≤
                            callback();
                        }, 200);
                    }
                });
            }

            showNumber();
        }

        // Ê∑ªÂä†ÈÅäÊà≤Âæ™Áí∞ÂáΩÊï∏
        let dropCounter = 0;
        let lastTime = 0;

        function gameLoop(time = 0) {
            if (gameState.isGameOver) return;

            const deltaTime = time - lastTime;
            lastTime = time;
            dropCounter += deltaTime;

            // Ê†πÊìöÁ≠âÁ¥öË™øÊï¥‰∏ãËêΩÈÄüÂ∫¶
            const dropInterval = Math.max(1000 - (gameState.level - 1) * 100, 100); // ÊúÄÂø´100ms‰∏ÄÊ¨°
            
            if (dropCounter > dropInterval) {
                dropPiece();
                dropCounter = 0;
            }

            draw();
            requestAnimationFrame(gameLoop);
        }

        // ‰øÆÊîπÂàùÂßãÂåñÂáΩÊï∏
        function initGame() {
            // ÂàùÂßãÂåñÈÅäÊà≤ÁãÄÊÖã
            gameState = {
                score: 0,
                level: 1,
                lines: 0,
                board: Array(BOARD_HEIGHT).fill().map(() => Array(BOARD_WIDTH).fill(0)),
                piece: createPiece(),
                nextPiece: createPiece(),
                position: {x: 0, y: 0},
                isGameOver: false
            };

            // Ë®≠ÁΩÆÂàùÂßã‰ΩçÁΩÆ
            gameState.position = {
                x: Math.floor(BOARD_WIDTH / 2) - Math.floor(gameState.piece[0].length / 2),
                y: 0
            };

            // Êõ¥Êñ∞ÂàÜÊï∏È°ØÁ§∫
            updateScore(0);
            updateLevel(1);

            // Ê∑ªÂä†‰∫ã‰ª∂Áõ£ËÅΩÂô®
            document.addEventListener('keydown', handleInput);
            document.addEventListener('keyup', handleInput);

            // ÂïüÂãïÈÅäÊà≤Âæ™Áí∞
            lastTime = 0;
            dropCounter = 0;
            requestAnimationFrame(gameLoop);
        }

        // ‰øÆÊîπÊ∏ÖÈô§Ë°åÁöÑÂáΩÊï∏
        function clearLines() {
            let linesCleared = [];
            
            // ÂÖàÊâæÂá∫Ë¶ÅÊ∂àÈô§ÁöÑË°å
            for (let y = BOARD_HEIGHT - 1; y >= 0; y--) {
                let isComplete = true;
                for (let x = 0; x < BOARD_WIDTH; x++) {
                    if (gameState.board[y][x] === 0) {
                        isComplete = false;
                        break;
                    }
                }
                if (isComplete) {
                    linesCleared.push(y);
                }
            }

            if (linesCleared.length > 0) {
                sounds.clear.play();
                
                // ‰∏ÄÊ¨°ÊÄßÁßªÈô§ÊâÄÊúâÂÆåÊï¥Ë°å
                linesCleared.sort((a, b) => b - a);
                linesCleared.forEach(y => {
                    gameState.board.splice(y, 1);
                });
                
                // Âú®È†ÇÈÉ®Ê∑ªÂä†Êñ∞ÁöÑÁ©∫Ë°å
                for (let i = 0; i < linesCleared.length; i++) {
                    gameState.board.unshift(Array(BOARD_WIDTH).fill(0));
                }

                // Êõ¥Êñ∞ÂàÜÊï∏
                gameState.lines += linesCleared.length;
                gameState.score += calculateScore(linesCleared.length);
                updateScore(gameState.score);
                
                // Êõ¥Êñ∞Á≠âÁ¥ö
                const newLevel = Math.floor(gameState.lines / 10) + 1;
                if (newLevel !== gameState.level) {
                    gameState.level = newLevel;
                    updateLevel(newLevel);
                }

                // ÈáçÁπ™ÈÅäÊà≤Êùø
                draw();
            }
        }

        // Ë®àÁÆóÂàÜÊï∏
        function calculateScore(lines) {
            const basePoints = [0, 40, 100, 300, 1200]; // 0, 1, 2, 3, 4 Ë°åÁöÑÂàÜÊï∏
            return basePoints[lines] * gameState.level;
        }

        // Êõ¥Êñ∞È°ØÁ§∫ÂàÜÊï∏
        function updateScore(score) {
            document.getElementById('score').textContent = score;
            document.getElementById('lines').textContent = gameState.lines;
        }

        // ‰øÆÊîπÈçµÁõ§ËôïÁêÜÂáΩÊï∏
        function handleInput(event) {
            if (gameState.isGameOver) return;

            // Êåâ‰∏ãÊåâÈçµ
            if (event.type === 'keydown') {
                if (!keyState[getKeyName(event.keyCode)]) {
                    keyState[getKeyName(event.keyCode)] = true;
                    
                    // Âü∑Ë°åÂàùÂßãÁßªÂãï
                    switch (event.keyCode) {
                        case 37: // Â∑¶ÁÆ≠È†≠
                            movePiece(-1);
                            // Ë®≠ÁΩÆÈáçË§áË®àÊôÇÂô®ÔºåÂÖàÁ≠âÂæÖ‰∏ÄÊÆµÊôÇÈñìÂÜçÈñãÂßãÈáçË§á
                            keyRepeatTimers.left = setTimeout(() => {
                                keyRepeatTimers.left = setInterval(() => movePiece(-1), KEY_REPEAT_INTERVAL);
                            }, KEY_REPEAT_DELAY);
                            break;
                        case 39: // Âè≥ÁÆ≠È†≠
                            movePiece(1);
                            keyRepeatTimers.right = setTimeout(() => {
                                keyRepeatTimers.right = setInterval(() => movePiece(1), KEY_REPEAT_INTERVAL);
                            }, KEY_REPEAT_DELAY);
                            break;
                        case 40: // ‰∏ãÁÆ≠È†≠
                            dropPiece();
                            keyRepeatTimers.down = setTimeout(() => {
                                keyRepeatTimers.down = setInterval(dropPiece, KEY_REPEAT_INTERVAL);
                            }, KEY_REPEAT_DELAY);
                            break;
                        case 38: // ‰∏äÁÆ≠È†≠
                            rotatePiece();
                            // Ê™¢Êü•ÊòØÂê¶ÂêåÊôÇÊåâËëóÂ∑¶Âè≥Èçµ
                            if (keyState.left) movePiece(-1);
                            if (keyState.right) movePiece(1);
                            break;
                        case 32: // Á©∫Ê†ºÈçµ
                            hardDrop();
                            break;
                    }
                }
            }
            // ÈáãÊîæÊåâÈçµ
            else if (event.type === 'keyup') {
                const keyName = getKeyName(event.keyCode);
                keyState[keyName] = false;
                
                // Ê∏ÖÈô§Â∞çÊáâÁöÑË®àÊôÇÂô®
                if (keyRepeatTimers[keyName]) {
                    clearTimeout(keyRepeatTimers[keyName]);
                    clearInterval(keyRepeatTimers[keyName]);
                    keyRepeatTimers[keyName] = null;
                }
            }
        }

        // ËºîÂä©ÂáΩÊï∏ÔºöÁç≤ÂèñÊåâÈçµÂêçÁ®±
        function getKeyName(keyCode) {
            switch (keyCode) {
                case 37: return 'left';
                case 39: return 'right';
                case 40: return 'down';
                case 38: return 'up';
                default: return null;
            }
        }

        // Âø´ÈÄü‰∏ãËêΩ
        function hardDrop() {
            while (!collide()) {
                gameState.position.y++;
            }
            gameState.position.y--;
            mergePiece();
            resetPiece();
            clearLines();
            sounds.drop.play();
        }

        // ‰øÆÊîπÈÅäÊà≤ÁµêÊùüËôïÁêÜÂáΩÊï∏
        function gameOver() {
            gameState.isGameOver = true;
            sounds.gameOver.play();
            bgMusic.stop();
            
            // ÂâµÂª∫ÁµêÊùüÂãïÁï´ÂÆπÂô®
            const gameOverContainer = document.createElement('div');
            gameOverContainer.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                background: rgba(0, 0, 0, 0.8);
                z-index: 1000;
                animation: fadeIn 0.5s ease-out;
            `;

            // ÂâµÂª∫ GAME OVER ÊñáÂ≠ó
            const gameOverText = document.createElement('div');
            gameOverText.className = 'game-over-text';
            gameOverText.textContent = 'GAME OVER';
            gameOverText.style.cssText = `
                color: #ff0000;
                font-size: 48px;
                font-family: 'Press Start 2P', cursive;
                text-shadow: 4px 4px 0px #000;
                margin-bottom: 20px;
                animation: gameOverDrop 1s ease-out, glowText 1.5s infinite alternate;
            `;

            // ÂâµÂª∫ÂàÜÊï∏È°ØÁ§∫
            const scoreText = document.createElement('div');
            scoreText.textContent = `ÂàÜÊï∏: ${gameState.score}`;
            scoreText.style.cssText = `
                color: #fff;
                font-size: 24px;
                font-family: 'Press Start 2P', cursive;
                margin-bottom: 20px;
                animation: fadeIn 1s ease-out 0.5s both;
            `;

            // ÂâµÂª∫ÈáçÊñ∞ÈñãÂßãÊèêÁ§∫
            const restartText = document.createElement('div');
            restartText.textContent = 'ÊåâÁ©∫Ê†ºÈçµÈáçÊñ∞ÈñãÂßã';
            restartText.style.cssText = `
                color: #fff;
                font-size: 16px;
                font-family: 'Press Start 2P', cursive;
                animation: blink 1s infinite;
            `;

            // Ê∑ªÂä†ÂãïÁï´Ê®£Âºè
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }

                @keyframes gameOverDrop {
                    0% { transform: translateY(-100vh); }
                    60% { transform: translateY(20px); }
                    80% { transform: translateY(-10px); }
                    100% { transform: translateY(0); }
                }

                @keyframes glowText {
                    from { text-shadow: 4px 4px 0px #000; }
                    to { text-shadow: 4px 4px 20px #ff0000; }
                }

                @keyframes blink {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.3; }
                }
            `;

            document.head.appendChild(style);
            gameOverContainer.appendChild(gameOverText);
            gameOverContainer.appendChild(scoreText);
            gameOverContainer.appendChild(restartText);
            document.querySelector('.game-container').appendChild(gameOverContainer);

            // ÁßªÈô§ÊâÄÊúâÈÅäÊà≤ÊéßÂà∂
            document.removeEventListener('keydown', handleInput);
            document.removeEventListener('keyup', handleInput);

            // Áõ£ËÅΩÈáçÊñ∞ÈñãÂßã
            const restartListener = (e) => {
                if (e.keyCode === 32) { // Á©∫Ê†ºÈçµ
                    document.removeEventListener('keydown', restartListener);
                    gameOverContainer.remove();
                    resetGame();
                }
            };
            document.addEventListener('keydown', restartListener);
        }

        // ÈáçÁΩÆÈÅäÊà≤
        function resetGame() {
            gameState = {
                score: 0,
                level: 1,
                lines: 0,
                board: Array(BOARD_HEIGHT).fill().map(() => Array(BOARD_WIDTH).fill(0)),
                piece: null,
                nextPiece: null,
                position: {x: 0, y: 0},
                isGameOver: false
            };

            // ÈáçÁΩÆÊåâÈçµÁãÄÊÖã
            Object.keys(keyState).forEach(key => {
                keyState[key] = false;
            });
            
            // Ê∏ÖÈô§ÊâÄÊúâË®àÊôÇÂô®
            Object.keys(keyRepeatTimers).forEach(key => {
                if (keyRepeatTimers[key]) {
                    clearInterval(keyRepeatTimers[key]);
                    keyRepeatTimers[key] = null;
                }
            });

            updateScore(0);
            updateLevel(1);
            startCountdown(initGame);
            if (bgMusic.isPlaying) {
                bgMusic.start();
            }
        }

        // ÂâµÂª∫Êñ∞ÊñπÂ°ä
        function createPiece() {
            const pieceType = Math.floor(Math.random() * 7) + 1;
            return PIECES[pieceType];
        }

        // Áπ™Ë£ΩÊñπÂ°ä
        function drawBlock(ctx, x, y, color) {
            const blockX = x * BLOCK_SIZE;
            const blockY = y * BLOCK_SIZE;
            const size = BLOCK_SIZE - 1;

            // ‰∏ªÈ´îÈ°èËâ≤
            ctx.fillStyle = color;
            ctx.fillRect(blockX, blockY, size, size);

            // ‰∫ÆÈù¢ÔºàÂ∑¶‰∏äÔºâ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.beginPath();
            ctx.moveTo(blockX, blockY);
            ctx.lineTo(blockX + size, blockY);
            ctx.lineTo(blockX + size - 4, blockY + 4);
            ctx.lineTo(blockX + 4, blockY + 4);
            ctx.lineTo(blockX + 4, blockY + size - 4);
            ctx.lineTo(blockX, blockY + size);
            ctx.closePath();
            ctx.fill();

            // ÊöóÈù¢ÔºàÂè≥‰∏ãÔºâ
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.moveTo(blockX + size, blockY);
            ctx.lineTo(blockX + size, blockY + size);
            ctx.lineTo(blockX, blockY + size);
            ctx.lineTo(blockX + 4, blockY + size - 4);
            ctx.lineTo(blockX + size - 4, blockY + size - 4);
            ctx.lineTo(blockX + size - 4, blockY + 4);
            ctx.closePath();
            ctx.fill();
        }

        // Áπ™Ë£ΩÈÅäÊà≤Áï´Èù¢
        function draw() {
            const mainCtx = document.getElementById('mainBoard').getContext('2d');
            const previewCtx = document.getElementById('previewBox').getContext('2d');

            // Ê∏ÖÈô§Áï´Èù¢
            mainCtx.fillStyle = 'rgba(0, 0, 51, 0.8)';
            mainCtx.fillRect(0, 0, mainBoard.width, mainBoard.height);
            previewCtx.fillStyle = 'rgba(0, 0, 51, 0.8)';
            previewCtx.fillRect(0, 0, previewBox.width, previewBox.height);

            // Áπ™Ë£ΩÈÅäÊà≤Êùø
            drawBoard(mainCtx);
            // Áπ™Ë£ΩÁï∂ÂâçÊñπÂ°ä
            drawPiece(mainCtx);
            // Áπ™Ë£ΩÈ†êË¶ΩÊñπÂ°ä
            drawNextPiece(previewCtx);
        }

        // Áπ™Ë£ΩÈÅäÊà≤Êùø
        function drawBoard(ctx) {
            // Áπ™Ë£ΩÁ∂≤Ê†ºÁ∑ö
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;

            // Áπ™Ë£ΩÊ∞¥Âπ≥Á∑ö
            for (let y = 0; y < BOARD_HEIGHT; y++) {
                ctx.beginPath();
                ctx.setLineDash([2, 2]); // Ë®≠ÁΩÆËôõÁ∑öÊ®£Âºè
                ctx.moveTo(0, y * BLOCK_SIZE);
                ctx.lineTo(BOARD_WIDTH * BLOCK_SIZE, y * BLOCK_SIZE);
                ctx.stroke();
            }

            // Áπ™Ë£ΩÂûÇÁõ¥Á∑ö
            for (let x = 0; x < BOARD_WIDTH; x++) {
                ctx.beginPath();
                ctx.setLineDash([2, 2]);
                ctx.moveTo(x * BLOCK_SIZE, 0);
                ctx.lineTo(x * BLOCK_SIZE, BOARD_HEIGHT * BLOCK_SIZE);
                ctx.stroke();
            }

            // Áπ™Ë£ΩÊñπÂ°ä
            gameState.board.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        drawBlock(ctx, x, y, COLORS[value]);
                    }
                });
            });
        }

        // Áπ™Ë£ΩÁï∂ÂâçÊñπÂ°ä
        function drawPiece(ctx) {
            // Áπ™Ë£ΩËêΩÈªûÈ†êË¶Ω
            const dropPos = getDropPosition();
            gameState.piece.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        // Áπ™Ë£ΩÂçäÈÄèÊòéÁöÑÈ†êË¶ΩÊñπÂ°ä
                        ctx.fillStyle = `${COLORS[value]}40`; // Ê∑ªÂä†40‰ΩúÁÇ∫ÈÄèÊòéÂ∫¶
                        ctx.fillRect(
                            (x + dropPos.x) * BLOCK_SIZE,
                            (y + dropPos.y) * BLOCK_SIZE,
                            BLOCK_SIZE - 1,
                            BLOCK_SIZE - 1
                        );
                    }
                });
            });

            // Áπ™Ë£ΩÁï∂ÂâçÊñπÂ°ä
            gameState.piece.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        drawBlock(
                            ctx,
                            x + gameState.position.x,
                            y + gameState.position.y,
                            COLORS[value]
                        );
                    }
                });
            });
        }

        // Áπ™Ë£ΩÈ†êË¶ΩÊñπÂ°ä
        function drawNextPiece(ctx) {
            const piece = gameState.nextPiece;
            const boxSize = 160; // È†êË¶ΩÊ°ÜÁöÑÂ§ßÂ∞è
            
            // Ë®àÁÆóÊñπÂ°äÁöÑÂØ¶ÈöõÂ§ßÂ∞è
            const pieceHeight = piece.length;
            const pieceWidth = piece[0].length;
            
            // Ë®àÁÆóÂ±Ö‰∏≠ÁöÑÂÅèÁßªÈáè
            const offsetX = Math.floor((boxSize / BLOCK_SIZE - pieceWidth) / 2);
            const offsetY = Math.floor((boxSize / BLOCK_SIZE - pieceHeight) / 2);

            // Ê∏ÖÈô§È†êË¶ΩÂçÄÂüü
            ctx.fillStyle = 'rgba(0, 0, 51, 0.8)';
            ctx.fillRect(0, 0, boxSize, boxSize);

            // Áπ™Ë£ΩÈ†êË¶ΩÊñπÂ°äÔºå‰ΩøÁî®Áõ∏ÂêåÁöÑÁ´ãÈ´îÊïàÊûúÂáΩÊï∏
            piece.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        drawBlock(ctx, x + offsetX, y + offsetY, COLORS[value]);
                    }
                });
            });
        }

        // Á¢∞ÊíûÊ™¢Ê∏¨
        function collide() {
            return checkCollision(gameState.piece, gameState.position.x, gameState.position.y);
        }

        // Ë®àÁÆóÊñπÂ°äËêΩÈªû‰ΩçÁΩÆ
        function getDropPosition() {
            const currentPiece = gameState.piece;
            const currentPos = {...gameState.position};
            let dropY = currentPos.y;

            while (!checkCollision(currentPiece, currentPos.x, dropY + 1)) {
                dropY++;
            }

            return {x: currentPos.x, y: dropY};
        }

        // Ê™¢Êü•Á¢∞Êíû
        function checkCollision(piece, x, y) {
            for (let r = 0; r < piece.length; r++) {
                for (let c = 0; c < piece[r].length; c++) {
                    if (!piece[r][c]) continue;
                    
                    let newY = y + r;
                    let newX = x + c;

                    if (newY >= BOARD_HEIGHT || newX < 0 || newX >= BOARD_WIDTH || 
                        (newY >= 0 && gameState.board[newY][newX])) {
                        return true;
                    }
                }
            }
            return false;
        }

        // ÊñπÂ°äÁßªÂãï
        function movePiece(dir) {
            gameState.position.x += dir;
            if (collide()) {
                gameState.position.x -= dir;
                return false;
            }
            sounds.move.play();
            return true;
        }

        // ‰øÆÊîπÊñπÂ°äÊóãËΩâÂáΩÊï∏
        function rotatePiece() {
            const originalPiece = gameState.piece;
            const originalX = gameState.position.x;
            
            // ÊóãËΩâÊñπÂ°ä
            const rotated = originalPiece[0].map((_, i) => 
                originalPiece.map(row => row[i]).reverse()
            );
            
            gameState.piece = rotated;
            
            // Ê™¢Êü•‰∏¶ÂòóË©¶‰∏çÂêåÁöÑ‰ΩçÁΩÆ
            const positions = [0, -1, 1, -2, 2]; // ÂòóË©¶ÁöÑ‰ΩçÁΩÆÈ†ÜÂ∫è

            for (let testOffset of positions) {
                gameState.position.x = originalX + testOffset;
                if (!collide()) {
                    sounds.rotate.play();
                    return true; // ÊâæÂà∞ÊúâÊïà‰ΩçÁΩÆ
                }
            }
            
            // Â¶ÇÊûúÊâÄÊúâ‰ΩçÁΩÆÈÉΩ‰∏çË°åÔºåÊÅ¢Âæ©ÂéüÁãÄ
            gameState.piece = originalPiece;
            gameState.position.x = originalX;
            return false;
        }

        // ÊñπÂ°ä‰∏ãËêΩ
        function dropPiece() {
            gameState.position.y++;
            if (collide()) {
                gameState.position.y--;
                mergePiece();
                resetPiece();
                clearLines();
            }
        }

        // Âêà‰ΩµÊñπÂ°äÂà∞ÈÅäÊà≤Êùø
        function mergePiece() {
            gameState.piece.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        gameState.board[y + gameState.position.y][x + gameState.position.x] = value;
                    }
                });
            });
        }

        // ÈáçÁΩÆÊñπÂ°ä
        function resetPiece() {
            gameState.piece = gameState.nextPiece;
            gameState.nextPiece = createPiece();
            gameState.position.y = 0;
            gameState.position.x = Math.floor(BOARD_WIDTH / 2) - Math.floor(gameState.piece[0].length / 2);
            
            if (collide()) {
                gameOver();
            }
        }

        // Êõ¥Êñ∞Á≠âÁ¥ö
        function updateLevel(level) {
            document.getElementById('level').textContent = level;
            if (level > gameState.level) {
                sounds.levelUp.play();
            }
        }

        // ‰øÆÊîπÈ†ÅÈù¢Âä†Ëºâ‰∫ã‰ª∂
        document.addEventListener('DOMContentLoaded', () => {
            // Ê∑ªÂä†ÈªûÊìä‰∫ã‰ª∂‰æÜÂàùÂßãÂåñÈü≥È†ª‰∏ä‰∏ãÊñáÔºàÂõ†ÁÇ∫ÁÄèË¶ΩÂô®ÊîøÁ≠ñË¶ÅÊ±ÇÔºâ
            document.addEventListener('click', () => {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }, { once: true });
            
            startCountdown(initGame);
        });

        // ÂâµÂª∫Èõ≤Êúµ
        function createCloud() {
            const cloud = document.createElement('div');
            cloud.className = 'pixel-cloud';
            
            const size = Math.random() * (160 - 80) + 80;
            cloud.style.width = size + 'px';
            cloud.style.height = (size * 0.6) + 'px';
            
            cloud.style.top = Math.random() * 60 + '%';
            cloud.style.left = '0';
            const duration = Math.random() * (30 - 20) + 20;
            
            cloud.style.animationDuration = `${duration}s`;
            
            cloud.innerHTML = `<svg class="cloud-svg"><use href="#cloud-svg"/></svg>`;
            
            document.body.appendChild(cloud);
            
            cloud.addEventListener('animationend', () => {
                cloud.remove();
            });
        }

        // ÂâµÂª∫È≥•
        function createBird() {
            const bird = document.createElement('div');
            bird.className = 'bird';
            
            const size = Math.random() * (50 - 30) + 30;
            bird.style.width = size + 'px';
            bird.style.height = (size * 0.6) + 'px';
            
            const startPositions = [
                { x: -100, y: Math.random() * 60 + 20 },
                { x: window.innerWidth + 100, y: Math.random() * 60 + 20 },
                { x: Math.random() * window.innerWidth, y: -100 },
                { x: Math.random() * window.innerWidth, y: window.innerHeight + 100 }
            ];
            
            const startPos = startPositions[Math.floor(Math.random() * startPositions.length)];
            const endPos = {
                x: Math.random() * window.innerWidth,
                y: Math.random() * (window.innerHeight - 200) + 100
            };
            
            const angle = Math.atan2(endPos.y - startPos.y, endPos.x - startPos.x) * 180 / Math.PI;
            
            bird.style.left = startPos.x + 'px';
            bird.style.top = startPos.y + 'px';
            
            const duration = Math.random() * (12 - 8) + 8;
            
            bird.animate([
                {
                    left: startPos.x + 'px',
                    top: startPos.y + 'px',
                    transform: `rotate(${angle}deg)`,
                    opacity: 1
                },
                {
                    left: endPos.x + 'px',
                    top: endPos.y + 'px',
                    transform: `rotate(${angle}deg)`,
                    opacity: 1
                }
            ], {
                duration: duration * 1000,
                easing: 'linear'
            });
            
            bird.innerHTML = `<svg class="bird-svg"><use href="#bird-svg"/></svg>`;
            
            document.body.appendChild(bird);
            
            setTimeout(() => bird.remove(), duration * 1000);
        }

        // ÂÆöÊúüÁîüÊàêÈõ≤ÂíåÈ≥•
        setInterval(createCloud, 5000);
        for(let i = 0; i < 5; i++) {
            setTimeout(createCloud, i * 1000);
        }

        function scheduleNextBird() {
            const delay = Math.random() * (15000 - 5000) + 5000;
            setTimeout(() => {
                createBird();
                scheduleNextBird();
            }, delay);
        }
        scheduleNextBird();

        // ‰øÆÊîπËÉåÊôØÈü≥Ê®ÇÂ∞çË±°
        const bgMusic = {
            context: null,
            oscillators: [],
            gainNodes: [],
            isPlaying: false,
            
            init() {
                this.context = new (window.AudioContext || window.webkitAudioContext)();
                this.createMelody();
            },
            
            createMelody() {
                const notes = {
                    'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23,
                    'G4': 392.00, 'A4': 440.00, 'B4': 493.88, 'C5': 523.25,
                    'D5': 587.33, 'E5': 659.25
                };

                // Êõ¥ËºïÂø´ÁöÑÊóãÂæãÂ∫èÂàó
                const melody = [
                    {note: 'E4', duration: 0.25}, {note: 'G4', duration: 0.25},
                    {note: 'C5', duration: 0.5},
                    {note: 'D4', duration: 0.25}, {note: 'F4', duration: 0.25},
                    {note: 'B4', duration: 0.5},
                    {note: 'C4', duration: 0.25}, {note: 'E4', duration: 0.25},
                    {note: 'A4', duration: 0.5},
                    {note: 'G4', duration: 0.25}, {note: 'B4', duration: 0.25},
                    {note: 'E5', duration: 0.5},
                    
                    {note: 'C5', duration: 0.25}, {note: 'A4', duration: 0.25},
                    {note: 'F4', duration: 0.5},
                    {note: 'B4', duration: 0.25}, {note: 'G4', duration: 0.25},
                    {note: 'D4', duration: 0.5},
                    {note: 'A4', duration: 0.25}, {note: 'F4', duration: 0.25},
                    {note: 'D4', duration: 0.5},
                    {note: 'G4', duration: 0.25}, {note: 'E4', duration: 0.25},
                    {note: 'C4', duration: 0.5}
                ];

                let time = 0;
                const baseVolume = 0.08;  // Á®çÂæÆË™øÊï¥Èü≥Èáè
                
                melody.forEach(({note, duration}) => {
                    setTimeout(() => {
                        if (this.isPlaying) {
                            const osc = this.context.createOscillator();
                            const gain = this.context.createGain();
                            
                            // ‰ΩøÁî®Ê∑∑ÂêàÈü≥Ëâ≤
                            osc.type = 'triangle';  // ‰ΩøÁî®‰∏âËßíÊ≥¢Áç≤ÂæóÊõ¥Ê∏ÖËÑÜÁöÑÈü≥Ëâ≤
                            
                            osc.frequency.setValueAtTime(notes[note], this.context.currentTime);
                            
                            // Êõ¥Âø´ÁöÑÈü≥ÈáèÂåÖÁµ°
                            gain.gain.setValueAtTime(0, this.context.currentTime);
                            gain.gain.linearRampToValueAtTime(baseVolume, this.context.currentTime + 0.05);
                            gain.gain.linearRampToValueAtTime(baseVolume * 0.6, this.context.currentTime + duration * 0.7);
                            gain.gain.linearRampToValueAtTime(0, this.context.currentTime + duration);
                            
                            osc.connect(gain);
                            gain.connect(this.context.destination);
                            
                            osc.start();
                            osc.stop(this.context.currentTime + duration);
                            
                            this.oscillators.push(osc);
                            this.gainNodes.push(gain);
                        }
                    }, time * 1000);
                    
                    time += duration;
                });
                
                // Âæ™Áí∞Êí≠Êîæ
                setTimeout(() => {
                    this.oscillators = [];
                    this.gainNodes = [];
                    if (this.isPlaying) {
                        this.createMelody();
                    }
                }, time * 1000);
            },
            
            start() {
                if (!this.isPlaying) {
                    this.isPlaying = true;
                    this.createMelody();
                }
            },
            
            stop() {
                this.isPlaying = false;
                this.oscillators.forEach(osc => {
                    try {
                        osc.stop();
                    } catch (e) {}
                });
                this.oscillators = [];
                this.gainNodes = [];
            }
        };

        // Âú®È†ÅÈù¢Âä†ËºâÊôÇÂàùÂßãÂåñËÉåÊôØÈü≥Ê®Ç
        document.addEventListener('DOMContentLoaded', () => {
            // Ê∑ªÂä†Èü≥Ê®ÇÊéßÂà∂ÊåâÈàï
            const musicBtn = document.createElement('button');
            musicBtn.innerHTML = 'üéµ';
            musicBtn.style.position = 'fixed';
            musicBtn.style.top = '20px';
            musicBtn.style.right = '20px';
            musicBtn.style.fontSize = '24px';
            musicBtn.style.padding = '10px';
            musicBtn.style.background = 'rgba(0, 0, 0, 0.5)';
            musicBtn.style.border = '2px solid #fff';
            musicBtn.style.borderRadius = '50%';
            musicBtn.style.color = '#fff';
            musicBtn.style.cursor = 'pointer';
            musicBtn.style.zIndex = '1000';
            
            let isMusicPlaying = false;
            
            musicBtn.addEventListener('click', () => {
                if (!bgMusic.context) {
                    bgMusic.init();
                }
                
                if (isMusicPlaying) {
                    bgMusic.stop();
                    musicBtn.style.opacity = '0.5';
                } else {
                    bgMusic.start();
                    musicBtn.style.opacity = '1';
                }
                isMusicPlaying = !isMusicPlaying;
            });
            
            document.body.appendChild(musicBtn);
        });
    </script>
</body>
</html> 